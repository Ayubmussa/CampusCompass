
{
  "entities": {
    "Location": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Location",
      "type": "object",
      "description": "Represents a specific location on the university campus.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Location entity (document ID)."
        },
        "name": {
          "type": "string",
          "description": "Name of the location (e.g., 'Main Library', 'Student Union')."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the location, can be AI-generated or admin-provided."
        },
        "coordinates": {
            "type": "object",
            "description": "Geographic coordinates for the map view.",
            "properties": {
                "lat": { "type": "number" },
                "lng": { "type": "number" }
            },
            "required": ["lat", "lng"]
        },
        "connections": {
            "type": "array",
            "description": "Array of hotspots linking to other locations. Defines connections within the 360-degree tour.",
            "items": {
                "type": "object",
                "properties": {
                    "pitch": { "type": "number", "description": "The vertical angle of the hotspot." },
                    "yaw": { "type": "number", "description": "The horizontal angle of the hotspot." },
                    "target": { "type": "string", "description": "The ID of the location this hotspot links to." },
                    "text": { "type": "string", "description": "The label that appears on the hotspot." }
                },
                "required": ["pitch", "yaw", "target", "text"]
            }
        },
        "panoramaUrl": {
          "type": "string",
          "description": "URL of the 360-degree panorama for the location. This URL points to a file in Supabase Storage."
        },
        "thumbnailUrl": {
            "type": "string",
            "description": "URL of a smaller thumbnail image for previews, stored in Supabase Storage."
        }
      },
      "required": [
        "name",
        "description",
        "coordinates",
        "panoramaUrl"
      ]
    },
     "SavedTour": {
      "title": "Saved Tour",
      "type": "object",
      "description": "Represents a tour generated by the AI and saved by a user.",
      "properties": {
        "name": {
          "type": "string",
          "description": "The AI-generated name of the saved tour."
        },
        "description": {
          "type": "string",
          "description": "An AI-generated description of the saved tour."
        },
        "locationIds": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "An array of location IDs included in the tour."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the tour was saved."
        }
      },
      "required": ["name", "description", "locationIds", "createdAt"]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile information stored in Supabase Postgres (users table).",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The user's unique ID from Supabase Auth."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "photoURL": {
          "type": "string",
          "format": "uri",
          "description": "URL of the user's profile picture."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the user profile was created."
        },
        "lastLogin": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the user's last login."
        },
        "isAdmin": {
            "type": "boolean",
            "description": "Whether the user has administrative privileges. Defaults to false."
        }
      },
      "required": [
        "uid",
        "email",
        "createdAt",
        "lastLogin"
      ]
    },
    "Review": {
        "title": "Review",
        "type": "object",
        "description": "A review for a specific campus location.",
        "properties": {
            "rating": {
                "type": "number",
                "description": "A star rating from 1 to 5."
            },
            "comment": {
                "type": "string",
                "description": "The text content of the review."
            },
            "userId": {
                "type": "string",
                "description": "The UID of the user who wrote the review (Supabase Auth user id)."
            },
            "displayName": {
                "type": "string",
                "description": "The display name of the user at the time of the review."
            },
            "createdAt": {
                "type": "string",
                "format": "date-time",
                "description": "The timestamp when the review was created."
            }
        },
        "required": ["rating", "comment", "userId", "displayName", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "email_password"
    ],
    "reasoning": "Email/password authentication via Supabase Auth. App supports browsing without signing in; additional features (reviews, saved tours) require auth."
  },
  "database": {
    "tables": [
      {
        "name": "locations",
        "description": "Stores information about specific locations on the university campus.",
        "columns": [
          { "name": "id", "type": "uuid", "default": "gen_random_uuid()", "pk": true },
          { "name": "name", "type": "text", "nullable": false },
          { "name": "description", "type": "text", "nullable": false },
          { "name": "panorama_url", "type": "text", "nullable": false },
          { "name": "thumbnail_url", "type": "text", "nullable": true },
          { "name": "coordinates", "type": "jsonb", "nullable": true, "example": {"lat": 0, "lng": 0} },
          { "name": "connections", "type": "jsonb", "nullable": true, "example": [{"pitch": 0, "yaw": 0, "target": "library", "text": "To Library"}] },
          { "name": "created_at", "type": "timestamptz", "default": "now()" },
          { "name": "updated_at", "type": "timestamptz", "default": "now()" }
        ]
      },
      {
        "name": "users",
        "description": "Profile table mapped to Supabase Auth users.",
        "columns": [
          { "name": "uid", "type": "uuid", "pk": true, "description": "Supabase Auth user id" },
          { "name": "email", "type": "text" },
          { "name": "display_name", "type": "text" },
          { "name": "photo_url", "type": "text" },
          { "name": "created_at", "type": "timestamptz", "default": "now()" },
          { "name": "last_login", "type": "timestamptz", "default": "now()" },
          { "name": "is_admin", "type": "boolean", "default": false }
        ]
      },
      {
        "name": "saved_tours",
        "description": "Stores AI-generated tours that have been saved by a specific user.",
        "columns": [
          { "name": "id", "type": "uuid", "default": "gen_random_uuid()", "pk": true },
          { "name": "user_id", "type": "uuid", "nullable": false, "fk": {"table": "users", "column": "uid"} },
          { "name": "name", "type": "text", "nullable": false },
          { "name": "description", "type": "text", "nullable": false },
          { "name": "location_ids", "type": "text[]", "nullable": false },
          { "name": "created_at", "type": "timestamptz", "default": "now()" }
        ]
      },
      {
        "name": "reviews",
        "description": "Stores reviews for a specific location.",
        "columns": [
          { "name": "id", "type": "uuid", "default": "gen_random_uuid()", "pk": true },
          { "name": "location_id", "type": "uuid", "nullable": false, "fk": {"table": "locations", "column": "id"} },
          { "name": "user_id", "type": "uuid", "nullable": false, "fk": {"table": "users", "column": "uid"} },
          { "name": "display_name", "type": "text", "nullable": true },
          { "name": "rating", "type": "int2", "nullable": false },
          { "name": "comment", "type": "text", "nullable": true },
          { "name": "created_at", "type": "timestamptz", "default": "now()" }
        ]
      }
    ],
    "rls_policies": [
      {
        "table": "locations",
        "policies": [
          { "name": "Locations are readable by all", "command": "SELECT", "using": "true" },
          { "name": "Only admins can insert/update/delete locations", "command": "ALL", "using": "exists (select 1 from users u where u.uid = auth.uid() and u.is_admin = true)", "check": "exists (select 1 from users u where u.uid = auth.uid() and u.is_admin = true)" }
        ]
      },
      {
        "table": "users",
        "policies": [
          { "name": "User can view own profile", "command": "SELECT", "using": "uid = auth.uid()" },
          { "name": "User can update own profile", "command": "UPDATE", "using": "uid = auth.uid()", "check": "uid = auth.uid()" }
        ]
      },
      {
        "table": "saved_tours",
        "policies": [
          { "name": "User can CRUD their tours", "command": "ALL", "using": "user_id = auth.uid()", "check": "user_id = auth.uid()" }
        ]
      },
      {
        "table": "reviews",
        "policies": [
          { "name": "Reviews readable by all", "command": "SELECT", "using": "true" },
          { "name": "Only authenticated users can insert", "command": "INSERT", "check": "user_id = auth.uid()" },
          { "name": "User can update/delete own reviews", "command": "ALL", "using": "user_id = auth.uid()", "check": "user_id = auth.uid()" }
        ]
      }
    ],
    "reasoning": "Normalized tables in Postgres with JSONB for flexible fields (coordinates, connections). RLS enforces authz aligned with app requirements."
  },
  "storage": {
    "buckets": [
      { "name": "locations", "public": true, "reason": "Serve public panorama and thumbnail images" }
    ]
  }
}
